J4de

medium

# The diversifer generated by `DiversifierFactory.sol#createDiversifier` cannot call the admin function of the sub-contract

## Summary

The diversifer generated by `DiversifierFactory.sol#createDiversifier` cannot call the admin function of the sub-contract

## Vulnerability Detail

Take the `createSwapper` function as an example.

```solidity
File: splits-diversifier/src/DiversifierFactory.sol
 66     function createDiversifier(CreateDiversifierParams calldata params_) external returns (address diversifier) {
 67         // create pass-through wallet w {this} as owner & no passThrough
 68         PassThroughWalletImpl passThroughWallet = passThroughWalletFactory.createPassThroughWallet(
 69             PassThroughWalletImpl.InitParams({owner: address(this), paused: params_.paused, passThrough: ADDRESS_ZERO})
 70         );
 71         diversifier = address(passThroughWallet);
 72
 73         // parse oracle params for swapper-recipients
 74         OracleImpl oracle = _parseOracleParams(diversifier, params_.oracleParams);
 75
 76         // create split w diversifier (pass-through wallet) as controller
 77         (address[] memory sortedAccounts, uint32[] memory sortedPercentAllocations) =
 78  1>         _parseRecipientParams(diversifier, oracle, params_.recipientParams);
 79         address passThroughSplit = splitMain.createSplit({
 80             accounts: sortedAccounts,
 81             percentAllocations: sortedPercentAllocations,
 82             distributorFee: 0,
 83             controller: diversifier
 84         });
```

`DiversifierFactory.sol#createDiversifier` function is used to create a new diversifer, which will further call the `_parseRecipientParams` function to create a swapper.

```solidity
File: splits-diversifier/src/DiversifierFactory.sol
 97     function _parseRecipientParams(
 98         address diversifier_,
 99         OracleImpl oracle_,
100         RecipientParams[] calldata recipientParams_
101     ) internal returns (address[] memory, uint32[] memory) {
102         OracleParams memory swapperOracleParams;
103         swapperOracleParams.oracle = oracle_;
104
105         // parse recipient params
106         uint256 length = recipientParams_.length;
107         PackedRecipient[] memory packedRecipients = new PackedRecipient[](length);
108         for (uint256 i; i < length;) {
109             RecipientParams calldata recipientParams = recipientParams_[i];
110             // use recipient account or, if empty, create a new swapper owned by diversifier using oracle & other args
111             address account = (recipientParams.account._isNotEmpty())
112                 ? recipientParams.account
113                 : address(
114                     swapperFactory.createSwapper(
115                         SwapperFactory.CreateSwapperParams({
116  1>                         owner: diversifier_,
117                             paused: false,
118                             beneficiary: recipientParams.createSwapperParams.beneficiary,
119                             tokenToBeneficiary: recipientParams.createSwapperParams.tokenToBeneficiary,
120                             oracleParams: swapperOracleParams
121                         })
122                     )
123                 );
```

When creating a swapper, the owner of the swapper will be set to the diversifer address.

```solidity
File: splits-swapper/src/SwapperImpl.sol
150     /// set beneficiary
151     function setBeneficiary(address beneficiary_) external onlyOwner {
152         $beneficiary = beneficiary_;
153         emit SetBeneficiary(beneficiary_);
154     }
155
156     /// set tokenToBeneficiary
157     function setTokenToBeneficiary(address tokenToBeneficiary_) external onlyOwner {
158         $tokenToBeneficiary = tokenToBeneficiary_;
159         emit SetTokenToBeneficiary(tokenToBeneficiary_);
160     }
161
162     /// set oracle
163     function setOracle(OracleImpl oracle_) external onlyOwner {
164         $oracle = oracle_;
165         emit SetOracle(oracle_);
166     }
```

The swapper has many function that only the owner can access, and these function play a key role. The problem now is that the owner of the swapper is diversifer, but there is no function in the diversifer contract to access these admin functions of the swapper.

## Impact

The admin functions of all contracts owned by diversifer cannot be called, resulting in the inability to set some key parameters.

## Code Snippet

https://github.com/0xSplits/splits-diversifier/blob/bdb11a10d9f3aaf731adca09d6a0e05ab359e188/src/DiversifierFactory.sol#L83

https://github.com/0xSplits/splits-diversifier/blob/bdb11a10d9f3aaf731adca09d6a0e05ab359e188/src/DiversifierFactory.sol#L116

https://github.com/0xSplits/splits-diversifier/blob/bdb11a10d9f3aaf731adca09d6a0e05ab359e188/src/DiversifierFactory.sol#L142

## Tool used

Manual Review

## Recommendation

It is recommended to add an function for setting sub-contract parameters in the `DiversifierFactory.sol` contract